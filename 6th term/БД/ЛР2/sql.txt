-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.arena
(
    id integer NOT NULL,
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    city character varying(255) COLLATE pg_catalog."default" NOT NULL,
    construction_year integer NOT NULL,
    capacity integer NOT NULL,
    club_id integer,
    CONSTRAINT arena_pkey PRIMARY KEY (id),
    CONSTRAINT arena_club_id_key UNIQUE (club_id)
);

CREATE TABLE IF NOT EXISTS public.club
(
    id integer NOT NULL,
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    city character varying(255) COLLATE pg_catalog."default" NOT NULL,
    foundation_year integer NOT NULL,
    conference character varying(255) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT club_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.player
(
    id integer NOT NULL,
    full_name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    age integer,
    country character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "number" integer,
    "position" character varying(50) COLLATE pg_catalog."default",
    grip character varying(50) COLLATE pg_catalog."default",
    points integer DEFAULT 0,
    club_id integer,
    CONSTRAINT player_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.player_match
(
    player_id integer NOT NULL,
    match_id integer NOT NULL,
    goals integer DEFAULT 0,
    assists integer DEFAULT 0,
    penalties integer DEFAULT 0,
    CONSTRAINT player_match_pkey PRIMARY KEY (player_id, match_id)
);

CREATE TABLE IF NOT EXISTS public.match
(
    id integer NOT NULL,
    date date NOT NULL,
    finish_type character varying(50) COLLATE pg_catalog."default",
    score character varying(10) COLLATE pg_catalog."default" NOT NULL,
    status character varying(50) COLLATE pg_catalog."default",
    arena_id integer,
    CONSTRAINT match_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.club_match
(
    club_id integer NOT NULL,
    match_id integer NOT NULL,
    role character varying(50) COLLATE pg_catalog."default",
    result character varying(50) COLLATE pg_catalog."default",
    CONSTRAINT club_match_pkey PRIMARY KEY (club_id, match_id)
);

CREATE TABLE IF NOT EXISTS public.match_referee
(
    match_id integer NOT NULL,
    referee_id integer NOT NULL,
    CONSTRAINT match_referee_pkey PRIMARY KEY (match_id, referee_id)
);

CREATE TABLE IF NOT EXISTS public.referee
(
    id integer NOT NULL,
    full_name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "number" integer,
    age integer,
    role character varying(50) COLLATE pg_catalog."default",
    CONSTRAINT referee_pkey PRIMARY KEY (id),
    CONSTRAINT referee_number_key UNIQUE ("number")
);

CREATE TABLE IF NOT EXISTS public.coach
(
    id integer NOT NULL,
    full_name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    age integer,
    country character varying(255) COLLATE pg_catalog."default" NOT NULL,
    games_count integer DEFAULT 0,
    club_id integer,
    CONSTRAINT coach_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.club_statistics
(
    id integer NOT NULL,
    games integer DEFAULT 0,
    wins integer DEFAULT 0,
    ot_wins integer DEFAULT 0,
    pb_wins integer DEFAULT 0,
    goals character varying(255) COLLATE pg_catalog."default" DEFAULT '0-0'::character varying,
    points integer DEFAULT 0,
    club_id integer,
    CONSTRAINT club_statistics_pkey PRIMARY KEY (club_statistics_id),
    CONSTRAINT club_statistics_club_id_key UNIQUE (club_id)
);

ALTER TABLE IF EXISTS public.arena
    ADD CONSTRAINT arena_club_id_fkey FOREIGN KEY (club_id)
    REFERENCES public.club (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS arena_club_id_key
    ON public.arena(club_id);


ALTER TABLE IF EXISTS public.player
    ADD CONSTRAINT player_club_id_fkey FOREIGN KEY (club_id)
    REFERENCES public.club (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.player_match
    ADD CONSTRAINT player_match_match_id_fkey FOREIGN KEY (match_id)
    REFERENCES public.match (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.player_match
    ADD CONSTRAINT player_match_player_id_fkey FOREIGN KEY (player_id)
    REFERENCES public.player (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.match
    ADD CONSTRAINT match_arena_id_fkey FOREIGN KEY (arena_id)
    REFERENCES public.arena (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.club_match
    ADD CONSTRAINT club_match_club_id_fkey FOREIGN KEY (club_id)
    REFERENCES public.club (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.club_match
    ADD CONSTRAINT club_match_match_id_fkey FOREIGN KEY (match_id)
    REFERENCES public.match (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.match_referee
    ADD CONSTRAINT match_referee_match_id_fkey FOREIGN KEY (match_id)
    REFERENCES public.match (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.match_referee
    ADD CONSTRAINT match_referee_referee_id_fkey FOREIGN KEY (referee_id)
    REFERENCES public.referee (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.coach
    ADD CONSTRAINT coach_club_id_fkey FOREIGN KEY (club_id)
    REFERENCES public.club (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.club_statistics
    ADD CONSTRAINT club_statistics_club_id_fkey FOREIGN KEY (club_id)
    REFERENCES public.club (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS club_statistics_club_id_key
    ON public.club_statistics(club_id);

END;